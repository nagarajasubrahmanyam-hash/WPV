<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Watch Prashna</title>
    <!-- Load Astronomy Engine for Planetary Calculations -->
    <script src="https://cdn.jsdelivr.net/npm/astronomy-engine@2.1.19/astronomy.browser.min.js"></script>
    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --accent: #bb86fc;
            --secondary: #03dac6;
            --danger: #cf6679;
            --border: #333;
            --gold: #f1c40f;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 { margin: 10px 0 5px 0; font-size: 1.4rem; text-align: center; color: var(--accent); }
        .subtitle { font-size: 0.85rem; color: #888; margin-bottom: 15px; text-align: center; }

        .container {
            width: 100%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        /* --- 1. WATCH & TATVA CARD --- */
        .info-card {
            background-color: var(--card-bg);
            padding: 15px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            border-left: 4px solid var(--secondary);
        }
        
        .clock-mini {
            width: 60px; height: 60px;
            border: 2px solid #444;
            border-radius: 50%;
            position: relative;
            background: #222;
            flex-shrink: 0;
            box-shadow: inset 0 0 5px #000;
        }
        /* Markers for clock */
        .clock-marker {
            position: absolute; width: 2px; height: 4px; background: #666; left: 29px; top: 0;
            transform-origin: 1px 30px;
        }

        .hand-min {
            position: absolute; bottom: 50%; left: 50%;
            transform-origin: bottom center;
            background-color: var(--secondary);
            width: 3px; height: 40%;
            border-radius: 2px;
            z-index: 2;
        }
        
        .hand-sec {
            position: absolute; bottom: 50%; left: 50%;
            transform-origin: bottom center;
            background-color: var(--danger);
            width: 1px; height: 45%;
            z-index: 3;
        }

        .center-dot {
            width: 4px; height: 4px; background: #fff; border-radius: 50%;
            position: absolute; top: 28px; left: 28px; z-index: 4;
        }
        
        .info-text { text-align: right; flex-grow: 1; margin-left: 15px; }
        .lagna-title { font-size: 1.1rem; font-weight: bold; color: var(--text-color); }
        .tatva-sub { font-size: 0.85rem; margin-top: 2px; }

        /* --- 2. PANCHANGA GRID --- */
        .panchanga-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        .p-box {
            background-color: #252525;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.85rem;
            display: flex;
            flex-direction: column;
            border: 1px solid #333;
        }
        .p-label { color: #888; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 2px; }
        .p-value { color: var(--gold); font-weight: 600; }

        /* --- 3. SOUTH INDIAN CHART --- */
        .chart-container {
            width: 100%;
            aspect-ratio: 1 / 1;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 2px;
            background-color: var(--border);
            border: 2px solid var(--border);
            border-radius: 4px;
            margin-top: 5px;
        }

        .sign-box {
            background-color: var(--card-bg);
            position: relative;
            padding: 2px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 0.8rem;
            overflow: hidden;
        }

        .center-box {
            grid-column: 2 / 4;
            grid-row: 2 / 4;
            background-color: #151515;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #444;
        }

        .planet-label { font-size: 0.85rem; font-weight: bold; color: var(--text-color); }
        .asc-label { color: var(--danger); font-weight: 900; font-size: 0.8rem; margin-bottom: 2px; }
        .sign-name-bg {
            position: absolute; bottom: 1px; right: 2px;
            font-size: 0.6rem; color: #333; font-weight: bold; text-transform: uppercase;
        }
        .active-lagna { background-color: #2d1f1f; box-shadow: inset 0 0 0 1px var(--danger); }
        
        /* Helper Colors */
        .element-fire { color: #ff6b6b; }
        .element-earth { color: #a8e6cf; }
        .element-air { color: #f8f3d4; }
        .element-water { color: #74b9ff; }
        .element-ether { color: #a29bfe; }

        /* Pulse animation for live feel */
        .live-dot {
            display: inline-block; width: 6px; height: 6px; 
            background: var(--danger); border-radius: 50%;
            margin-right: 5px;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse { 0% {opacity: 1;} 50% {opacity: 0.4;} 100% {opacity: 1;} }

    </style>
</head>
<body>

    <h1>Watch Prashna</h1>
    <div class="subtitle"><span class="live-dot"></span>Live Dynamic Time</div>

    <div class="container">
        
        <!-- Watch Info -->
        <div class="info-card">
            <div class="clock-mini">
                <!-- Markers -->
                <div class="clock-marker" style="transform: rotate(0deg)"></div>
                <div class="clock-marker" style="transform: rotate(90deg)"></div>
                <div class="clock-marker" style="transform: rotate(180deg)"></div>
                <div class="clock-marker" style="transform: rotate(270deg)"></div>
                
                <div class="hand-min" id="minHand"></div>
                <div class="hand-sec" id="secHand"></div>
                <div class="center-dot"></div>
            </div>
            <div class="info-text">
                <div id="lagnaDisplay" class="lagna-title">-- Lagna</div>
                <div id="tatvaDisplay" class="tatva-sub">--</div>
            </div>
        </div>

        <!-- Panchanga Dashboard -->
        <div class="panchanga-grid">
            <div class="p-box">
                <div class="p-label">Tithi</div>
                <div class="p-value" id="tithiVal">--</div>
            </div>
            <div class="p-box">
                <div class="p-label">Nakshatra</div>
                <div class="p-value" id="nakVal">--</div>
            </div>
            <div class="p-box">
                <div class="p-label">Vara (Day)</div>
                <div class="p-value" id="varaVal">--</div>
            </div>
            <div class="p-box">
                <div class="p-label">Yoga</div>
                <div class="p-value" id="yogaVal">--</div>
            </div>
        </div>

        <!-- Chart -->
        <div class="chart-container">
            <!-- Row 1 -->
            <div class="sign-box" id="sign-11"><span class="sign-name-bg">Pis</span></div>
            <div class="sign-box" id="sign-0"><span class="sign-name-bg">Ari</span></div>
            <div class="sign-box" id="sign-1"><span class="sign-name-bg">Tau</span></div>
            <div class="sign-box" id="sign-2"><span class="sign-name-bg">Gem</span></div>
            <!-- Row 2 -->
            <div class="sign-box" id="sign-10"><span class="sign-name-bg">Aqu</span></div>
            <div class="center-box">
                <div style="font-size:1.5rem;">üïâÔ∏è</div>
                <div id="centerTime" style="margin-top:5px; font-size:1rem; color:#e0e0e0; font-family:monospace;">--:--:--</div>
            </div>
            <div class="sign-box" id="sign-3"><span class="sign-name-bg">Can</span></div>
            <!-- Row 3 -->
            <div class="sign-box" id="sign-9"><span class="sign-name-bg">Cap</span></div>
            <div class="sign-box" id="sign-4"><span class="sign-name-bg">Leo</span></div>
            <!-- Row 4 -->
            <div class="sign-box" id="sign-8"><span class="sign-name-bg">Sag</span></div>
            <div class="sign-box" id="sign-7"><span class="sign-name-bg">Sco</span></div>
            <div class="sign-box" id="sign-6"><span class="sign-name-bg">Lib</span></div>
            <div class="sign-box" id="sign-5"><span class="sign-name-bg">Vir</span></div>
        </div>

    </div>

<script>
    // --- 1. DATA CONSTANTS ---
    const signNames = ["Aries", "Taurus", "Gemini", "Cancer", "Leo", "Virgo", "Libra", "Scorpio", "Sagittarius", "Capricorn", "Aquarius", "Pisces"];
    
    // Panchanga Data
    const nakshatras = [
        "Ashwini", "Bharani", "Krittika", "Rohini", "Mrigashira", "Ardra", "Punarvasu", "Pushya", "Ashlesha",
        "Magha", "Purva Phalguni", "Uttara Phalguni", "Hasta", "Chitra", "Swati", "Vishakha", "Anuradha", "Jyeshtha",
        "Mula", "Purva Ashadha", "Uttara Ashadha", "Shravana", "Dhanishtha", "Shatabhisha", "Purva Bhadrapada", "Uttara Bhadrapada", "Revati"
    ];

    const yogas = [
        "Vishkumbha", "Priti", "Ayushman", "Saubhagya", "Sobhana", "Atiganda", "Sukarma", "Dhriti", "Shula",
        "Ganda", "Vriddhi", "Dhruva", "Vyaghata", "Harshana", "Vajra", "Siddhi", "Vyatipata", "Variyan",
        "Parigha", "Shiva", "Siddha", "Sadhya", "Shubha", "Shukla", "Brahma", "Indra", "Vaidhriti"
    ];

    const tithiNames = [
        "Pratipada", "Dvitiya", "Tritiya", "Chaturthi", "Panchami", "Shasthi", "Saptami", "Ashtami", 
        "Navami", "Dashami", "Ekadashi", "Dwadashi", "Trayodashi", "Chaturdashi", "Purnima",
        "Pratipada", "Dvitiya", "Tritiya", "Chaturthi", "Panchami", "Shasthi", "Saptami", "Ashtami", 
        "Navami", "Dashami", "Ekadashi", "Dwadashi", "Trayodashi", "Chaturdashi", "Amavasya"
    ];

    const weekDays = [
        { day: "Sunday", ruler: "Sun" }, { day: "Monday", ruler: "Moon" }, 
        { day: "Tuesday", ruler: "Mars" }, { day: "Wednesday", ruler: "Mercury" }, 
        { day: "Thursday", ruler: "Jupiter" }, { day: "Friday", ruler: "Venus" }, 
        { day: "Saturday", ruler: "Saturn" }
    ];

    const oddTatva = [
        { el: "Agni (Fire)", p: "Mars" }, { el: "Vayu (Air)", p: "Saturn" }, 
        { el: "Akash (Ether)", p: "Jupiter" }, { el: "Prithvi (Earth)", p: "Mercury" }, { el: "Jala (Water)", p: "Venus" }
    ];
    const evenTatva = [
        { el: "Jala (Water)", p: "Venus" }, { el: "Prithvi (Earth)", p: "Mercury" }, 
        { el: "Akash (Ether)", p: "Jupiter" }, { el: "Vayu (Air)", p: "Saturn" }, { el: "Agni (Fire)", p: "Mars" }
    ];

    // --- 2. CALCULATIONS ---

    function getAyanamsa(date) {
        const baseDate = new Date('2000-01-01');
        const days = (date - baseDate) / (1000 * 60 * 60 * 24);
        return 23.85 + ((days / 365.25) * 0.01397);
    }

    function normalize(deg) {
        let d = deg % 360;
        if (d < 0) d += 360;
        return d;
    }

    function calculateData(date) {
        const ayanamsa = getAyanamsa(date);
        
        const sunVec = Astronomy.GeoVector(Astronomy.Body.Sun, date, true);
        const moonVec = Astronomy.GeoVector(Astronomy.Body.Moon, date, true);
        
        const sunEcl = Astronomy.Ecliptic(sunVec);
        const moonEcl = Astronomy.Ecliptic(moonVec);
        
        const sunSidereal = normalize(sunEcl.elon - ayanamsa);
        const moonSidereal = normalize(moonEcl.elon - ayanamsa);

        // Panchanga
        const nakIndex = Math.floor(moonSidereal / 13.333333);
        let diff = normalize(moonSidereal - sunSidereal);
        const tithiIndex = Math.floor(diff / 12); 
        const paksha = tithiIndex < 15 ? "Shukla" : "Krishna";
        const sum = normalize(moonSidereal + sunSidereal);
        const yogaIndex = Math.floor(sum / 13.333333);
        const dayIdx = date.getDay(); 

        const bodies = [
            { name: "Su", obj: Astronomy.Body.Sun },
            { name: "Mo", obj: Astronomy.Body.Moon },
            { name: "Me", obj: Astronomy.Body.Mercury },
            { name: "Ve", obj: Astronomy.Body.Venus },
            { name: "Ma", obj: Astronomy.Body.Mars },
            { name: "Ju", obj: Astronomy.Body.Jupiter },
            { name: "Sa", obj: Astronomy.Body.Saturn }
        ];
        
        const chartPlanets = bodies.map(b => {
            const v = Astronomy.GeoVector(b.obj, date, true);
            const e = Astronomy.Ecliptic(v);
            const sid = normalize(e.elon - ayanamsa);
            return {
                name: b.name,
                sign: Math.floor(sid / 30),
                deg: sid % 30
            };
        });

        return {
            panchanga: {
                tithi: `${tithiNames[tithiIndex]} (${paksha})`,
                nakshatra: nakshatras[nakIndex],
                yoga: yogas[yogaIndex],
                vara: weekDays[dayIdx].day + ` (${weekDays[dayIdx].ruler})`
            },
            planets: chartPlanets
        };
    }

    // --- 3. UI UPDATE LOOP ---

    function loop() {
        const now = new Date();
        
        // --- A. Clock Visuals ---
        const mins = now.getMinutes();
        const secs = now.getSeconds();
        
        // Degrees
        const minDeg = (mins * 6) + (secs * 0.1); // Smooth minute movement
        const secDeg = secs * 6; // Second hand movement

        document.getElementById('minHand').style.transform = `rotate(${minDeg}deg)`;
        document.getElementById('secHand').style.transform = `rotate(${secDeg}deg)`;
        
        // Digital Time
        document.getElementById('centerTime').innerText = now.toLocaleTimeString([], {hour12: false});

        // --- B. Lagna & Tatva ---
        const lagnaIndex = Math.floor(mins / 5);
        const offset = mins % 5;
        
        document.getElementById('lagnaDisplay').innerText = signNames[lagnaIndex];

        const isOdd = (lagnaIndex % 2 === 0);
        const t = isOdd ? oddTatva[offset] : evenTatva[offset];
        
        let c = "element-earth";
        if(t.el.includes("Fire")) c = "element-fire";
        if(t.el.includes("Water")) c = "element-water";
        if(t.el.includes("Air")) c = "element-air";
        if(t.el.includes("Ether")) c = "element-ether";
        
        document.getElementById('tatvaDisplay').innerHTML = `<span class="${c}">${t.el}</span> ‚Ä¢ ${t.p}`;

        // --- C. Calculations (Run every second to catch day/sign changes instantly) ---
        // Note: Optimization - Planets don't move much in 1 sec, but this ensures Tithi/Nak changes are instant.
        const data = calculateData(now);

        // Panchanga UI
        document.getElementById('tithiVal').innerText = data.panchanga.tithi;
        document.getElementById('nakVal').innerText = data.panchanga.nakshatra;
        document.getElementById('varaVal').innerText = data.panchanga.vara;
        document.getElementById('yogaVal').innerText = data.panchanga.yoga;
        
        // Chart UI
        // Clear old
        for(let i=0; i<12; i++) {
            const box = document.getElementById(`sign-${i}`);
            box.className = 'sign-box';
            const bgSpan = box.querySelector('.sign-name-bg');
            box.innerHTML = ''; 
            box.appendChild(bgSpan);
        }

        // Active Lagna
        const lagnaBox = document.getElementById(`sign-${lagnaIndex}`);
        lagnaBox.classList.add('active-lagna');
        const asc = document.createElement('div');
        asc.className = 'asc-label'; asc.innerText = 'ASC';
        lagnaBox.appendChild(asc);

        // Place Planets
        data.planets.forEach(p => {
            const box = document.getElementById(`sign-${p.sign}`);
            const div = document.createElement('div');
            div.className = 'planet-label';
            div.innerText = p.name;
            box.appendChild(div);
        });
    }

    // Start Loop
    loop(); // Initial call
    setInterval(loop, 1000); // Repeat every 1 second

</script>
</body>
</html>